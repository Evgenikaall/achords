<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Append page</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Nixie+One&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/append-page.css}">
    <link rel="stylesheet" th:href="@{/css/alert-style.css}">


</head>

<script>
    // global var list
    let genres_counter = 1;
    let languages_counter = 1;
    let strumming_counter = 1;
</script>


<script>
    let option;
    let select
    $(document).ready(
        $.get("api/authors", function (authorsList) {
                select = document.getElementById("select_authors");
                if (authorsList !== undefined) {
                    for (let author of authorsList) {
                        author = author["authorsName"].toString();
                        option = document.createElement("option");
                        option.setAttribute("value", author.toString());
                        option.setAttribute("class", "option-selector-customer");
                        option.innerHTML = author.toString();
                        select.appendChild(option);
                    }
                }
            }
        ),
        $.get("api/difficult_level", function (difficult_level_list) {
            select = document.getElementById("select_difficult");
            if (difficult_level_list !== undefined) {
                for (let difficult_level of difficult_level_list) {
                    difficult_level = difficult_level["difficultName"].toString();
                    option = document.createElement("option");
                    option.setAttribute("value", difficult_level.toString());
                    option.setAttribute("class", "option-selector-customer");
                    option.innerHTML = difficult_level.toString();
                    select.appendChild(option);
                }
            }
        }),
        $.get("api/strumming_pattern", function (patterns) {
            select = document.getElementById("strumming-pattern-selector-info0");
            if (patterns !== undefined) {
                genres_counter = 1;
                for (let pattern of patterns) {
                    pattern = pattern["strummingPatternName"];
                    option = document.createElement("option");
                    option.setAttribute("class", "option-selector-customer");
                    option.setAttribute("value", pattern.toString());
                    option.innerHTML = pattern.toString();
                    select.appendChild(option);
                }
            }
        }),
        $.get("api/section_type", function (section_types_list) {
            select = document.getElementById("select_section_type");
            if (section_types_list !== undefined) {
                for (let section_type of section_types_list) {
                    section_type = section_type["sectionTypeName"].toString();
                    option = document.createElement("option");
                    option.setAttribute("value", section_type.toString());
                    option.setAttribute("class", "option-selector-customer");
                    option.innerHTML = section_type.toString();
                    select.appendChild(option);
                }
            }
        }),
        $.get("api/language", function (languages_list) {
            select = document.getElementById("language-selector-info0");
            if (languages_list !== undefined) {
                languages_counter = 1;
                for (let language of languages_list) {
                    language = language["languageName"].toString();
                    option = document.createElement("option");
                    option.setAttribute("value", language.toString());
                    option.setAttribute("class", "option-selector-customer");
                    option.innerHTML = language.toString();
                    select.appendChild(option);
                }
            }
        }),
        $.get("api/genres", function (genres) {
            select = document.getElementById("genres-selector-info0");
            if (genres !== undefined) {
                genres_counter = 1;
                for (let genre of genres) {
                    genre = genre["nameGenre"].toString();
                    option = document.createElement("option");
                    option.setAttribute("value", genre.toString());
                    option.setAttribute("class", "option-selector-customer");
                    option.innerHTML = genre.toString();
                    select.appendChild(option);
                }
            }
            // init custom modal
            customAlert = new customAlertModal();
        })
    )
</script>

<script>
    let customAlert;

    class customAlertModal {
        constructor() {
            this.$overlay = $("#dialogoverlay");
            this.$box = $("#dialogbox");
            this.$head = $("#dialogboxhead");
            this.$body = $("#dialogboxbody");
            this.$foot = $("#dialogboxfoot");
        }

        customAlertShow(message, title) {
            this.$overlay.show();
            this.$box.show();
            this.$head.show();
            this.$body.show();
            this.$foot.show();

            let winH = window.innerHeight;
            this.$overlay.css("height", winH.toString() + "px");
            if (typeof title === 'undefined') {
                this.$head.hide();
            } else {
                this.$head.html('<i class="fa fa-exclamation-circle" aria-hidden="true"></i> ' + title.toString());
            }
            this.$foot.html('<button class="plus-button" onclick="customAlert.hideElements()">OK</button>');
            this.$body.html(message);
        }

        hideElements() {
            this.$overlay.fadeOut("slow", function () {
                $(this).hide()
            });
            this.$box.fadeOut("slow", function () {
                $(this).hide()
            });
        }
    }

</script>

<script>

    function addStrummingSelection() {
        $.get("api/strumming_pattern", function (patterns) {

            let section = document.getElementById("strumming_pattern_block");
            if (section.childElementCount - 1 < patterns.length) {

                let selection = document.createElement("select");
                selection.setAttribute("class", "input-form-customer input-text-customer " +
                    "select-form-customer input-text-customer w-75 multi");
                selection.setAttribute("onchange","validateForm()");

                selection.setAttribute("id","strumming-pattern-selector-info".concat(strumming_counter.toString()));

                strumming_counter++;

                let option = document.createElement("option");
                option.setAttribute("class", "option-selector-customer");
                option.setAttribute("disabled", "");
                option.setAttribute("selected", "");
                option.innerHTML = "Choose song's strumming patterns";
                selection.appendChild(option)

                if (patterns !== undefined) {
                    for (let pattern of patterns) {
                        pattern = pattern["strummingPatternName"];
                        option = document.createElement("option");
                        option.setAttribute("class", "option-selector-customer");
                        option.setAttribute("value", pattern.toString());
                        option.innerHTML = pattern.toString();
                        selection.appendChild(option);
                    }

                }
                section.appendChild(selection);
            } else {

                customAlert.customAlertShow("Are selected more patterns than allowed", "Warning !");
            }


        })
    }

    function addLanguageSelector() {
        $.get("api/language", function (languages) {
            let section = document.getElementById("language_block");
            if (section.childElementCount - 1 < languages.length) {
                let selection = document.createElement("select");
                selection.setAttribute("class", "input-form-customer input-text-customer " +
                    "select-form-customer input-text-customer w-75 multi");
                selection.setAttribute("onchange","validateForm()");
                selection.setAttribute("id","language-selector-info".concat(languages_counter.toString()));

                languages_counter++;

                let option = document.createElement("option");
                option.setAttribute("class", "option-selector-customer");
                option.setAttribute("disabled", "");
                option.setAttribute("selected", "");
                option.innerHTML = "Choose song's language";
                selection.appendChild(option)

                if (languages !== undefined) {
                    for (let language of languages) {
                        language = language["languageName"];
                        option = document.createElement("option");
                        option.setAttribute("class", "option-selector-customer");
                        option.setAttribute("value", language.toString());
                        option.innerHTML = language.toString();
                        selection.appendChild(option);
                    }
                }

                section.appendChild(selection);
            } else {
                customAlert.customAlertShow("Are selected more languages than allowed", "Warning !");
            }
        })
    }

    function addGenresSelector() {
        $.get("api/genres", function (genres) {
            let section = document.getElementById("genres_selector_block");
            if (section.childElementCount - 1 < genres.length) {

                let selection = document.createElement("select");
                selection.setAttribute("class", "input-form-customer input-text-customer " +
                    "select-form-customer input-text-customer w-75 multi");
                selection.setAttribute("onchange","validateForm()");
                selection.setAttribute("id","genres-selector-info".concat(genres_counter.toString()));
                let option = document.createElement("option");
                option.setAttribute("class", "option-selector-customer");
                option.setAttribute("disabled", "");
                option.setAttribute("selected", "");
                option.innerHTML = "Choose song's genres";
                selection.appendChild(option)

                genres_counter++;

                if (genres !== undefined) {
                    for (let genre of genres) {
                        genre = genre["nameGenre"];
                        option = document.createElement("option");
                        option.setAttribute("class", "option-selector-customer");
                        option.setAttribute("value", genre.toString());
                        option.innerHTML = genre.toString();
                        selection.appendChild(option);
                    }
                }

                section.appendChild(selection);
            } else {
                customAlert.customAlertShow("Are selected more genres than allowed", "Warning !");
            }
        })
    }
</script>

<script>
    function validateForm(){
        var song = $("#song_name").val();
        var author = $("#author").val();
        var genres = [];
        for (let i = 0; i < genres_counter;i++){
            genres.push($("#genres-selector-info".concat(i.toString())).val());
        }
        var difficult = $("#select_difficult").val();
        var strummingPatterns = [];
        for (let i = 0; i < strumming_counter;i++){
            strummingPatterns.push($("#strumming-pattern-selector-info".concat(i.toString())).val());
        }
        var sectionType = $("#select_section_type").val();
        var languages = [];
        for(let i = 0; i < languages_counter;i++){
            languages.push($("#language-selector-info".concat(i.toString())).val())
        }

        var lyrics = $("#song_text");

        console.log(song);
        console.log(author);
        console.log(genres);
        console.log(difficult);
        console.log(strummingPatterns);
        console.log(sectionType);
        console.log(languages);
        console.log(lyrics);
        console.log("--------")
    }
</script>

<body class="page">
<div class="append-body-placement">
    <div class="container">
        <div class="append-body">
            <h1 class="append-body-header bottom-part text-center">Append new song</h1>
            <form action="" class="append-form-container">
                <div class="row">
                    <div class="col-sm-7 block-customer left-block-customer">
                        <div class="form-group-customer">
                            <label for="song_name" class="input-text-label-customer input-text-customer w-100">Input song's name</label>
                            <input type="text" placeholder="Song's name" id="song_name" onchange="validateForm()"
                                   class="input-form-customer song-name w-75">
                        </div>
                        <div class="form-group-customer">
                            <label for="select_authors" class="input-text-label-customer w-100">Choose song's
                                author</label>
                            <input id="author" list="select_authors" onchange="validateForm()"
                                   class="input-form-customer input-text-customer select-form-customer input-text-customer w-75"
                                   placeholder="Choose song's author">
                            <datalist id="select_authors"
                                      class="input-form-customer input-text-customer select-form-customer input-text-customer w-75">
                            </datalist>
                        </div>
                        <div class="form-group-customer" id="genres_selector_block">
                            <label class="input-text-label-customer w-100 row justify-content-between">
                                <div>Choose song's genres</div>
                                <button type="button" class="plus-button" onclick="addGenresSelector()">+</button>
                            </label>
                            <select
                                    id="genres-selector-info0" onchange="validateForm()"
                                    class="genres-selector-info input-form-customer input-text-customer select-form-customer input-text-customer w-75 multi">
                                <option disabled selected class="option-selector-customer">Choose song's genres</option>
                            </select>
                        </div>
                        <div class="form-group-customer">
                            <label for="select_difficult" class="input-text-label-customer w-100">Choose song's
                                difficult</label>
                            <select id="select_difficult" onchange="validateForm()"
                                    class="input-form-customer input-text-customer select-form-customer input-text-customer w-75">
                                <option disabled selected class="option-selector-customer">Choose song's difficult
                                    level
                                </option>
                            </select>
                        </div>
                        <div class="form-group-customer" id="strumming_pattern_block">
                            <label for="strumming-pattern-selector-info0" class="input-text-label-customer w-100 row justify-content-between">
                                <div>Choose song's strumming patterns</div>
                                <button type="button" class="plus-button" onclick="addStrummingSelection()">+</button>
                            </label>
                            <select
                                    id="strumming-pattern-selector-info0" onchange="validateForm()"
                                    class="strumming-pattern-selector-info input-form-customer input-text-customer select-form-customer input-text-customer w-75 multi">
                                <option disabled selected class="option-selector-customer">Choose song's strumming
                                    patterns
                                </option>
                            </select>
                        </div>
                        <div class="form-group-customer">
                            <label for="select_section_type" class="input-text-label-customer w-100">Choose song's
                                section type</label>
                            <select id="select_section_type" onchange="validateForm()"
                                    class="input-form-customer input-text-customer select-form-customer input-text-customer w-75">
                                <option disabled selected class="option-selector-customer multi">Choose song's section
                                    type
                                </option>
                            </select>
                        </div>
                        <div class="form-group-customer" id="language_block">
                            <label for="language-selector-info0"
                                   class="language-selector-info input-text-label-customer w-100 row justify-content-between">
                                <div>Choose song's language</div>
                                <button type="button" class="plus-button" onclick="addLanguageSelector()">+</button>
                            </label>
                            <select id="language-selector-info0" onchange="validateForm()"
                                    class="input-form-customer multi input-text-customer select-form-customer input-text-customer w-75">
                                <option disabled selected class="option-selector-customer">Choose song's language
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-5 block-customer">
                        <textarea onchange="validateForm()" id="song_text"
                                class="song-input input-form-customer text-area-customer input-text-customer song-input-text"
                                placeholder="Song's lyrics..."></textarea>
                    </div>
                </div>
            </form>
            <div class="append-body-header top-part text-center">

                <button>button</button>
            </div>
        </div>
    </div>
</div>
<div id="dialogoverlay"></div>
<div id="dialogbox" class="slit-in-vertical">
    <div>
        <div id="dialogboxhead"></div>
        <div id="dialogboxbody"></div>
        <div id="dialogboxfoot"></div>
    </div>
</div>

</body>
</html>